\section{Preliminaries and Definitions}
{\color{red} Talk about KBs. Describe what entities and literals are}

\subsection{Language} \label{sec:language}
{\color{red} Horn Rule. Given the definition of a \emph{valid} rule (each variables appearing twice and each variable connected transitevily to every other variable) and also give the definition of a valid body (a and b at least once, other variables twice).
Extension of predicates with inequalities.
Define instantiation of an atom.}


A Horn Rule $r$ has the form $A_1 \wedge A_2 \wedge \cdots \wedge A_n \Rightarrow \atom{r}{a}{b}$, where  $A_1 \wedge A_2 \wedge \cdots \wedge A_n = r_{body}$ is the \emph{body} of the rule.

\subsection{Coverage}
Given a pair of entities $(x,y)$ from the KB and a Horn Rule $r$, we say that $r_{body}$ \emph{covers} $(x,y)$ if
$(x,y) \models r_{body}$. In other words, given a Horn Rule $r = r_{body} \Rightarrow \atom{r}{a}{b}$, $r_{body}$ covers a pair of entities $(x,y)$ iff $r_{body}$ can be instantiated over the KB by substituting $a$ with $x$ and $b$ with $y$. Given a set of pair of entities $E = \{(x_1,y_1),(x_2,y_2),\cdots,(x_n,y_n)\}$ and a rule $r$, we denote by $C_r(E)$ the \emph{coverage} of $r_{body}$ over $E$ as the set of elements in $E$ covered by $r$, $C_r(E)=\{(x,y) \in E | (x,y) \models r_{body}\}$.

Given the body $r_{body}$ of a Horn Rule $r$, we denote by $r^{*}_{body}$ the \emph{unbounded body} of $r$. The unbounded body of a rule is obtained by substituting each atom in $r$ that contains either variable $a$ or $b$ with a new atom where the other variable that is not $a$ or $b$ 
is substituted with another unique variable. As an example, given $r_{body} = \atom{rel}{a}{b}$, $r^{*}_{body} = \atom{rel}{a}{v_1} \wedge \atom{rel}{v_2}{b}$.
\paolo{I suggest to have $rel_3(a,b)$ to avoid the confusion raised by cartesian product} 
\stefano{Better now?}
Given a set of pair of entities $E = \{(x_1,y_1),(x_2,y_2),\cdots,(x_n,y_n)\}$ and a rule $r$, we denote by $U_r(E)$ the \emph{unbounded coverage} of $r^{*}_{body}$ over $E$ as the set of elements in $E$ covered by $r^{*}_{body}$, $U_r(E)=\{(x,y) \in E | (x,y) \models r^{*}_{body}\}$.

\begin{myExample}
	Given the negative rule $r$ of Example~\ref{ex:intro} and a KB $K$, we denote by $E$ the set of all possible pairs of entities in $K$. The coverage of $r$ over $E$ $(C_r(E))$ is the set of all pairs of entities $(x,y)$ where both $x$ and $y$ have the \emph{\texttt{birthDate}} information and $x$ is born after $y$, while the unbounded coverage of $r$ over $E$ $(U_r(E))$ is the set of all pairs of entities $(x,y)$ where both $x$ and $y$ have the \emph{\texttt{birthDate}} information, no matter what the relation is between the two birth dates. 
\end{myExample}

The unbounded coverage is essential to distinguish between missing and inconsistent information: if for a pair of entities $(x,y)$ the \texttt{birthDate} information is missing from the KB for either $x$ or $y$, we cannot say whether $x$ was born before or after $y$, therefore we cannot be sure that the negative rule of Example~\ref{ex:intro} does not cover $(x,y)$. Instead if both $x$ and $y$ have the \texttt{birthDate} information and $x$ was born before $y$, we can affirm that the negative rule of Example~\ref{ex:intro} does not cover $(x,y)$. Given that modern KBs are largely incomplete (REFERENCE), discriminating between missing and conflicting information becomes of paramount importance.

Similarly, the coverage and the unbounded coverage for a set of rules $R=\{r_1,r_2,\cdots,r_n\}$ is the union of individual coverages:

$$C_R(E) = \bigcup \limits_{r \in R} C_r(E) \qquad U_R(E) = \bigcup \limits_{r \in R} U_r(E) $$

Our problem is the discovery of positive (negative) rules for an input given relation. We uniquely identify a relation with two different sets of pair of entities.
	$G$ -- \emph{generation set}. $G$ contains good examples for the relation that we are trying to discover ($G$ contains examples of parents and children if we are discovering positive rules for a child relation).
	$V$ -- the validation set. $V$ contains counter examples for the target relation (pairs of people that are not in a child relation).
We will explain in Section~\ref{sec:examples_gen} how to generate these two sets for a given relation.
Note that our approach is not less generic than those for mining rules for the entire KB (e.g.,~\cite{abedjan2014amending,galarraga2015fast}): it is true that we require a target relation as input, however we can generically apply such setting for every relation in the KB and compute rules for each of them.


We can now formalize the \emph{exact discovery problem}.
Given a KB $K$, a set of pair of entities $G$, a set of pair of entities $V$, and a universe of rules $R$, 
a solution for the \emph{exact discovery problem} is a subset $R'$ of $R$  such that:
$$R_{opt}=\underset{|R'|}{\operatorname{argmin}}(R'|(C_{R'}(G) = G) \wedge (C_{R'}(V) \cap V = \emptyset) )$$
The ideal solution is a set of rules that covers all examples in $G$, and none of the examples in $V$. Note that given a pair of entities $(x,y)$, we can always generate a Horn Rule whose body covers only $(x,y)$ by assigning variable $a$ to $x$ and variable $b$ to $y$.

Unfortunately, since the solution is not allowed to cover any element in $V$, in the worst case the exact solution may be a set of rules s.t. each rule covers only one example in $G$, making such set of rules difficult to use.

\subsection{Weight Function}
In order to allow flexibility and errors in both $G$ and $V$, we drop the strict requirement of not covering any element of $V$. However, since covering elements in $V$ is an indication of potential errors, we want to limit the coverage over $V$ to the minimum possible. We therefore define a $weight$ to be associated with a rule.


Given a KB $K$, two sets of pair of entities $G$ and $V$ from $K$ where $G \cap V = \emptyset$, and a Horn Rule $r$, the weight of $r$ is defined as follow:
\begin{equation*}
	w(r) = \alpha \cdot (1-\frac{\mid C_{r}(G)\mid}{\mid G \mid}) +\beta \cdot (\frac{\mid C_{r}(V) \mid}{\mid U_{r}(V)\mid})  +\gamma \cdot (1-\frac{\mid U_{r}(V)\mid}{\mid V \mid})
\end{equation*}
with $\alpha,\beta,\gamma \in [0,1]$ and $\alpha + \beta + \gamma = 1$. The weight is a value between $0$ and $1$ that captures the \emph{goodness} of a rule w.r.t. $G$ and $V$: the better the rule, the lower the weight -- perfect rule would have a weight of $0$. The weight is made of three components normalized by the three parameters $\alpha,\beta,\gamma$.
\begin{inparaenum}[\itshape(i)]
	\item The first component captures the coverage over the generation set $G$ -- the ratio between the coverage of $r$ over $G$ and $G$ itself. Note that if $r$ covers all elements in $G$, then this componenet is $0$ because of the subtraction from $1$.
	\item The second component aims to quantify potential errors of $r$, or rather the coverage over $V$. The coverage over $V$ is not divided by total elements in $V$, because 
	for thos elemenets in $V$ that do not have relations stated in $r$ we cannot be sure that such elements are not covered by $r$. Thus we divide the coverage over $V$ by the unbounded coverage of $r$ over $V$. Ideally this number is close to $0$.
	\item The last element of the weight captures how many elements of $V$ have the information stated by relations in $r$. The more elements in $V$ are unbounded covered by $r$, the better we can judge the rule w.r.t. $V$. This element is close to $0$ when $r$ unbounded covers many elements of $V$. 
\end{inparaenum}
The parameters $\alpha,\beta,\gamma$ are used to give more relevance to some components. We would set a high $\beta$ if we want to discover rules with high precision that identifies few mistakes, or we would set a high $\alpha$ if we are more interested in recall and the discovered rules should identify as many examples as possible.

\begin{myExample}
	W.r.t. the negative rule $r$ of Example~\ref{ex:intro}, given two sets of pair of entities $G$ and $V$ the three components of $w_r$ are computed as follow:
	\begin{inparaenum}[\itshape(i)]
		\item the first component is computed as 1 minus number of pairs $(x,y)$ in $G$ where
		$x$ is born after $y$ divided by the number of elements in $G$;
		\item the second component is the ratio between number of pairs $(x,y)$ in $V$ where $x$ is born after $y$ and number of pairs $(x,y)$ in $V$ where the date of birth (for both $x$ and $y$) is available in the KB;
		\item the last component is computed as 1 minus number of pairs $(x,y)$ in $V$ where the date of birth (for both $x$ and $y$) is available in the KB divided by the total number of elements in $V$.
	\end{inparaenum}
\end{myExample}
	

Similarly, the weight for a set of rules $R$ is defined as:
\begin{equation*}
w(R) = \alpha \cdot (1-\frac{\mid C_{R}(G)\mid}{\mid G \mid}) +\beta \cdot (\frac{\mid C_{R}(V) \mid}{\mid U_{R}(V)\mid})  +\gamma \cdot (1-\frac{\mid U_{R}(V)\mid}{\mid V \mid})
\end{equation*}

Assigning a weight to one or multiple rules allows us to take into consideration an important aspect of modern KBs: the presence of errors. We will show in the experimental evaluation that very rarely rules have a $0$ coverage over the validation set, and very often good rules have a significant coverage over $V$. The exact discovery problem implies the absence of errors in the input KB, unfortunately such assumption is too strong for modern KBs that are automatically built(REFERENCE).

\subsection{Problem Definition}
We can now state the approximate version of the problem.


Given a KB $K$, two sets of pair of entities $G$ and $V$ from $K$ where $G \cap V = \emptyset$, a universe of rules $R$, and a $w$ weight function for $R$,
a solution for the \emph{approximate discovery problem} is a subset $R'$ of $R$  such that:

$$R_{opt}=\underset{w(R')}{\operatorname{argmin}}(R'|R'(G) = G)$$


We can map this problem to the well-known weighted set cover problem, which is proven to be a NP-Complete problem~\cite{chvatal1979greedy}, where the universe is $G$ and the sets are all the possible rules defined in $R$.

Since we want to minimise the total weight of the output rules, the approximate version of the discovery problem aims to cover all elements in $G$, and as few as possible elements in $V$. Since for each element $(x,y)$ in $G$ there always exists a rule that covers only $(x,y)$ (single-instance rule), an optimal output is always guaranteed to exist. We expect such output to be made of some rules that covers more than one example in $G$, and the remaining examples in $G$ to be covered by single-instance rules. In the best-case scenario a single rule covers all elements in $G$ and none of the elements in $V$.

Section~\ref{sec:greedy_alg} will describe a greedy polynomial algorithm to find a good solution for our problem.



